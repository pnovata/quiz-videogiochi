<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Game Quiz - Studenti</title>
    <style>
        :root {
            --color-primary: #2180a0;
            --color-primary-hover: #1d7488;
            --color-success: #22c55e;
            --color-error: #ef4444;
            --color-bg: #f5f5f5;
            --color-surface: #ffffff;
            --color-text: #1f2121;
            --color-text-secondary: #626c7c;
            --color-border: #e5e7eb;
            --space-16: 16px;
            --space-20: 20px;
            --space-24: 24px;
            --radius-md: 8px;
            --duration-normal: 250ms;
        }
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            margin: 0;
            padding: var(--space-20);
            background-color: var(--color-bg);
            color: var(--color-text);
            line-height: 1.6;
        }
        .container { max-width: 800px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: var(--space-24); }
        h1 { margin: 0 0 var(--space-20) 0; font-size: 28px; color: var(--color-text); }
        .login-section { display: flex; gap: var(--space-16); justify-content: center; margin-bottom: var(--space-24); flex-wrap: wrap; background-color: var(--color-surface); padding: var(--space-20); border-radius: var(--radius-md); box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); }
        .form-group { display: flex; flex-direction: column; gap: var(--space-8); }
        .form-label { font-weight: 600; font-size: 14px; color: var(--color-text); }
        .form-input { padding: var(--space-12); border: 2px solid var(--color-border); border-radius: var(--radius-md); font-size: 16px; font-family: inherit; min-width: 200px; }
        .form-input:focus { outline: none; border-color: var(--color-primary); box-shadow: 0 0 0 3px rgba(33, 128, 160, 0.1); }
        .btn { padding: var(--space-12) var(--space-20); border: none; border-radius: var(--radius-md); font-size: 16px; font-weight: 600; cursor: pointer; transition: all var(--duration-normal); }
        .btn--primary { background-color: var(--color-primary); color: #ffffff; }
        .btn--primary:hover { background-color: var(--color-primary-hover); }
        .btn--secondary { background-color: var(--color-border); color: var(--color-text); }
        .btn--secondary:hover { background-color: #d1d5db; }
        .error-message { color: var(--color-error); font-size: 14px; padding: var(--space-12); background-color: #fef2f2; border: 1px solid #fecaca; border-radius: var(--radius-md); margin-bottom: var(--space-16); display: none; }
        .error-message.show { display: block; }
        .quiz-section { display: none; }
        .quiz-section.active { display: block; }
        .question { background-color: var(--color-surface); padding: var(--space-20); border-radius: var(--radius-md); margin-bottom: var(--space-20); box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); }
        .question-title { font-weight: 600; font-size: 16px; margin-bottom: var(--space-16); color: var(--color-text); }
        .options { display: flex; flex-direction: column; gap: var(--space-12); }
        .option { display: flex; align-items: center; gap: var(--space-12); }
        .option input[type="radio"] { cursor: pointer; width: 18px; height: 18px; }
        .option label { cursor: pointer; flex: 1; }
        .progress-bar { width: 100%; height: 8px; background-color: var(--color-border); border-radius: 4px; margin-bottom: var(--space-20); overflow: hidden; }
        .progress-fill { height: 100%; background-color: var(--color-primary); transition: width 0.3s; }
        .button-group { display: flex; gap: var(--space-12); justify-content: center; margin-top: var(--space-20); }
        .result-screen { display: none; text-align: center; padding: var(--space-24); background-color: var(--color-surface); border-radius: var(--radius-md); }
        .result-screen.active { display: block; }
        .result-score { font-size: 48px; font-weight: 700; color: var(--color-primary); margin: var(--space-20) 0; }
        .result-percentage { font-size: 24px; color: var(--color-text-secondary); margin-bottom: var(--space-20); }
        .result-message { font-size: 18px; margin-bottom: var(--space-20); }
        .success { color: var(--color-success); }
        .warning { color: var(--color-error); }
        .loading { text-align: center; padding: var(--space-24); }
        .spinner { display: inline-block; width: 40px; height: 40px; border: 4px solid var(--color-border); border-top-color: var(--color-primary); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .button-group-results { display: flex; gap: var(--space-12); justify-content: center; margin-top: var(--space-20); flex-wrap: wrap; }
        .info-box { background-color: #e0f2fe; border: 1px solid #0284c7; color: #075985; padding: var(--space-12); border-radius: var(--radius-md); margin-top: var(--space-16); font-size: 13px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ Video Game Quiz</h1>
        </div>

        <!-- LOGIN SECTION -->
        <div class="login-section" id="loginSection">
            <div class="form-group">
                <label class="form-label">üë§ Nome</label>
                <input type="text" id="nameInput" class="form-input" placeholder="Inserisci il tuo nome">
            </div>
            <div style="display: flex; align-items: flex-end;">
                <button class="btn btn--primary" onclick="startQuiz()">Inizia Quiz</button>
            </div>
            <div class="error-message" id="errorMessage">Inserisci il tuo nome!</div>
        </div>

        <!-- QUIZ SECTION -->
        <div class="quiz-section" id="quizSection">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div id="questionContainer"></div>
            <div class="button-group">
                <button class="btn btn--secondary" onclick="previousQuestion()" id="prevBtn">‚Üê Indietro</button>
                <button class="btn btn--primary" onclick="nextQuestion()" id="nextBtn">Avanti ‚Üí</button>
            </div>
        </div>

        <!-- RESULT SECTION -->
        <div class="result-screen" id="resultScreen">
            <h2>Quiz Completato! ‚úÖ</h2>
            <div class="result-score" id="resultScore">0/10</div>
            <div class="result-percentage" id="resultPercentage">0%</div>
            <div class="result-message" id="resultMessage"></div>
            <div style="margin-top: var(--space-24);">
                <div id="loadingIndicator" class="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Risultato salvato nel browser! ‚úÖ</p>
                </div>
                <div class="button-group-results" style="display: none;" id="resultButtons">
                    <button class="btn btn--primary" onclick="location.reload()">Riprova</button>
                    <button class="btn btn--secondary" onclick="downloadExcelProtected()">üì• Scarica Excel üîí</button>
                    <button class="btn btn--secondary" onclick="viewAllResults()">üìä Visualizza Risultati</button>
                </div>
                <div class="info-box" style="display: none;" id="infoBox">
                    üîí <strong>File protetto:</strong> Password: <code style="background: white; padding: 2px 6px; border-radius: 3px;">Quiz2025</code>
                </div>
            </div>
        </div>
    </div>

    <!-- Libreria per generare Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script>
        // ‚úÖ CONFIGURAZIONE - LocalStorage (niente server needed!)
        const STORAGE_KEY = 'quiz_results';
        const EXCEL_PASSWORD = 'Quiz2025'; // Password preimpostata

        // DOMANDE DEL QUIZ
        const questions = [
            {
                question: "Qual √® il miglior gioco di ruolo di sempre?",
                options: ["The Witcher 3", "Baldur's Gate 3", "Final Fantasy VII", "Dark Souls"],
                correct: 1
            },
            {
                question: "Quale console ha venduto pi√π unit√†?",
                options: ["PlayStation 2", "Nintendo Wii", "Nintendo DS", "PlayStation 4"],
                correct: 0
            },
            {
                question: "Chi ha creato Mario?",
                options: ["Hideo Kojima", "Shigeru Miyamoto", "Yoichi Miyaji", "Satoru Iwata"],
                correct: 1
            },
            {
                question: "In che anno √® uscito The Legend of Zelda?",
                options: ["1985", "1986", "1987", "1988"],
                correct: 0
            },
            {
                question: "Quale √® il videogioco pi√π venduto di sempre?",
                options: ["Minecraft", "Tetris", "Wii Sports", "Grand Theft Auto V"],
                correct: 0
            },
            {
                question: "Quanti controller aveva il Nintendo 64?",
                options: ["2", "3", "4", "1"],
                correct: 2
            },
            {
                question: "Chi ha sviluppato Fortnite?",
                options: ["Riot Games", "Epic Games", "Activision", "Rockstar Games"],
                correct: 1
            },
            {
                question: "In che anno √® uscito il primo Pokemon?",
                options: ["1994", "1996", "1998", "2000"],
                correct: 1
            },
            {
                question: "Quale gioco ha il miglior gameplay secondo i criteri moderni?",
                options: ["Elden Ring", "Zelda: Breath of the Wild", "Red Dead 2", "Half-Life 2"],
                correct: 1
            },
            {
                question: "Quanti Souls-like ha creato FromSoftware?",
                options: ["4", "5", "6+", "3"],
                correct: 2
            }
        ];

        // VARIABILI GLOBALI
        let currentQuestion = 0;
        let answers = new Array(questions.length).fill(null);
        let studentName = '';

        // FUNZIONI
        function startQuiz() {
            studentName = document.getElementById('nameInput').value.trim();
            if (!studentName) {
                document.getElementById('errorMessage').classList.add('show');
                return;
            }
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('quizSection').classList.add('active');
            renderQuestion();
        }

        function renderQuestion() {
            const question = questions[currentQuestion];
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';

            let html = `
                <div class="question">
                    <div class="question-title">${currentQuestion + 1}. ${question.question}</div>
                    <div class="options">
            `;

            question.options.forEach((option, idx) => {
                const isChecked = answers[currentQuestion] === idx ? 'checked' : '';
                html += `
                    <div class="option">
                        <input type="radio" name="answer" id="opt${idx}" value="${idx}" ${isChecked} onchange="answers[${currentQuestion}] = ${idx}">
                        <label for="opt${idx}">${option}</label>
                    </div>
                `;
            });

            html += `</div></div>`;
            document.getElementById('questionContainer').innerHTML = html;

            // Aggiorna bottoni
            document.getElementById('prevBtn').style.display = currentQuestion === 0 ? 'none' : 'block';
            document.getElementById('nextBtn').textContent = currentQuestion === questions.length - 1 ? 'Fine Quiz ‚úì' : 'Avanti ‚Üí';
            document.getElementById('nextBtn').onclick = currentQuestion === questions.length - 1 ? finishQuiz : nextQuestion;
        }

        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                renderQuestion();
            }
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                renderQuestion();
            }
        }

        function finishQuiz() {
            const score = answers.reduce((acc, ans, idx) => {
                return acc + (ans === questions[idx].correct ? 1 : 0);
            }, 0);

            const percentage = Math.round((score / questions.length) * 100);

            document.getElementById('quizSection').classList.remove('active');
            document.getElementById('resultScreen').classList.add('active');
            document.getElementById('resultScore').textContent = `${score}/${questions.length}`;
            document.getElementById('resultPercentage').textContent = `${percentage}%`;

            if (percentage >= 70) {
                document.getElementById('resultMessage').innerHTML = `<span class="success">Ottimo! Hai superato il quiz! üéâ</span>`;
            } else if (percentage >= 50) {
                document.getElementById('resultMessage').innerHTML = `<span class="warning">Hai passato il quiz, ma puoi fare di meglio! üí™</span>`;
            } else {
                document.getElementById('resultMessage').innerHTML = `<span class="warning">Devi studiare di pi√π! Riprova! üìö</span>`;
            }

            // Salva i dati
            saveResults(score, percentage);
        }

        function saveResults(score, percentage) {
            document.getElementById('loadingIndicator').style.display = 'block';

            const today = new Date().toLocaleDateString('it-IT');
            
            const result = {
                nome: studentName,
                punteggio: score,
                percentuale: percentage,
                data: today,
                timestamp: new Date().toISOString()
            };

            // Leggi i risultati precedenti
            let results = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
            
            // Aggiungi il nuovo risultato
            results.push(result);
            
            // Salva nel LocalStorage
            localStorage.setItem(STORAGE_KEY, JSON.stringify(results));

            console.log('‚úÖ Risultato salvato nel browser!', result);
            
            setTimeout(() => {
                document.getElementById('loadingIndicator').style.display = 'none';
                document.getElementById('resultButtons').style.display = 'flex';
                document.getElementById('infoBox').style.display = 'block';
            }, 1000);
        }

        function downloadExcelProtected() {
            const results = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
            
            if (results.length === 0) {
                alert('Nessun risultato da scaricare!');
                return;
            }

            // Crea i dati per Excel
            const data = [
                ['Nome', 'Punteggio', 'Percentuale', 'Data'],
                ...results.map(r => [r.nome, r.punteggio, r.percentuale + '%', r.data])
            ];

            // Crea il workbook
            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Risultati');

            // Formattazione
            ws['!cols'] = [
                { wch: 20 },
                { wch: 12 },
                { wch: 12 },
                { wch: 15 }
            ];

            // Proteggi il foglio con password
            ws['!protect'] = {
                sheet: true,
                content: true,
                scenarios: true,
                password: EXCEL_PASSWORD,
                objects: true,
                selectLocked: true
            };

            // Scarica il file
            XLSX.writeFile(wb, `quiz_risultati_${new Date().getTime()}.xlsx`);
            
            console.log('‚úÖ Excel protetto scaricato! Password:', EXCEL_PASSWORD);
        }

        function viewAllResults() {
            const results = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
            
            if (results.length === 0) {
                alert('Nessun risultato salvato!');
                return;
            }

            let message = 'üìä RISULTATI QUIZ:\n\n';
            results.forEach((r, idx) => {
                message += `${idx + 1}. ${r.nome} - ${r.punteggio}/10 (${r.percentuale}%) - ${r.data}\n`;
            });

            alert(message);
        }

        console.log('‚úÖ Quiz pronto! - Excel protetto con password:', EXCEL_PASSWORD);
    </script>
</body>
</html>
